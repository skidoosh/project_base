---
- name: Include global variables
  include_vars: variables/main.yml

- name: Update apt cache
  become: true
  apt:
    update_cache: true
    cache_valid_time: 3600

- name: Install packages
  become: true
  apt:
    name: "{{ item }}"
    state: latest
  with_items: "{{ __packages }}"

- name: Replace fix_pathinfo
  become: true
  replace:
    regexp: '^;cgi\.fix_pathinfo=1$'
    replace: 'cgi.fix_pathinfo=0'
    path: '/etc/php/7.0/fpm/php.ini'
    backup: true
  notify: restart php-fpm

- name: Install nginx server config
  become: true
  copy:
    src: files/nginx.default
    dest: /etc/nginx/sites-available/default
    backup: true
    owner: root
    group: root
    mode: 0755
  notify: restart nginx
